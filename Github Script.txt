#!/bin/bash
set -e

git_repo="https://github.com/sufanshaikh/my_website.git"
temp_dir="/tmp/webrepo"
dest_dir="/var/www/html"
Port=80

echo "Updating System ..."
sudo apt update -y && sudo apt upgrade -y

echo "Installing Nginx and Git ...."
sudo apt install nginx git -y

echo "Enabling and starting Nginx ..."
sudo systemctl enable nginx
sudo systemctl start nginx

echo "Cleaning default Directory...."
sudo rm -rf $dest_dir/*

echo "Cloning Your Static Website...."
sudo rm -rf $temp_dir
git clone $git_repo $temp_dir

echo "Copying files to web root..."
sudo cp -r $temp_dir/* $dest_dir/

echo "Setting Correct Permission..."
sudo chown -R www-data:www-data $dest_dir
sudo chmod -R 755 $dest_dir

echo "Testing Nginx Configuration..."
sudo nginx -t

echo "Reloading Nginx ...."
sudo systemctl reload nginx

echo "<<<<<.....Deployment Complete.....>>>>>"
